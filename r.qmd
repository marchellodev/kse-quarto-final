---
title: "r Maps test"
---

## Quarto

Quarto enables you to weave together content and executable code into a finished document. To learn more about Quarto see <https://quarto.org>.

```{r}
#|echo: false
library(sf)
library(raster)
library(dplyr)
library(spData)
library(maps)
# library(spDataLarge)

library(tmap)    # for static and interactive maps
library(ggplot2) # tidyverse data visualization package

library("rnaturalearth")
library("rnaturalearthdata")
```


```{r}

source("load_data.R")

oblasts <- list()

oblasts <- c(oblasts, list(list(shapeISO="UA-65", name="Херсонська_область")))
oblasts <- c(oblasts, list(list(shapeISO="UA-07", name="Волинська_область")))
oblasts <- c(oblasts, list(list(shapeISO="UA-56", name="Рівненська_область")))
oblasts <- c(oblasts, list(list(shapeISO="UA-18", name="Житомирська_область")))
oblasts <- c(oblasts, list(list(shapeISO="UA-32", name="Київська_область")))
oblasts <- c(oblasts, list(list(shapeISO="UA-74", name="Чернігівська_область")))
oblasts <- c(oblasts, list(list(shapeISO="UA-59", name="Сумська_область")))
oblasts <- c(oblasts, list(list(shapeISO="UA-63", name="Харківська_область")))
oblasts <- c(oblasts, list(list(shapeISO="UA-09", name="Luhanks oblast")))
oblasts <- c(oblasts, list(list(shapeISO="UA-14", name="Донецька_область")))
oblasts <- c(oblasts, list(list(shapeISO="UA-23", name="Запорізька_область")))
oblasts <- c(oblasts, list(list(shapeISO="UA-46", name="Львівська_область")))
oblasts <- c(oblasts, list(list(shapeISO="UA-26", name="ІваноФранківська_область")))
oblasts <- c(oblasts, list(list(shapeISO="UA-21", name="Закарпатська_область")))
oblasts <- c(oblasts, list(list(shapeISO="UA-61", name="Тернопільська_область")))
oblasts <- c(oblasts, list(list(shapeISO="UA-77", name="Чернівецька_область")))
oblasts <- c(oblasts, list(list(shapeISO="UA-51", name="Одеська_область")))
oblasts <- c(oblasts, list(list(shapeISO="UA-48", name="Миколаївська_область")))
oblasts <- c(oblasts, list(list(shapeISO="UA-43", name="Autonomous Republic of Crimea")))
oblasts <- c(oblasts, list(list(shapeISO="UA-05", name="Вінницька_область")))
oblasts <- c(oblasts, list(list(shapeISO="UA-68", name="Хмельницька_область")))
oblasts <- c(oblasts, list(list(shapeISO="UA-71", name="Черкаська_область")))
oblasts <- c(oblasts, list(list(shapeISO="UA-53", name="Полтавська_область")))
oblasts <- c(oblasts, list(list(shapeISO="UA-12", name="Дніпропетровська_область")))
oblasts <- c(oblasts, list(list(shapeISO="UA-35", name="Кіровоградська_область")))
oblasts <- c(oblasts, list(list(shapeISO="UA-30", name="м_Київ")))
oblasts <- c(oblasts, list(list(shapeISO="UA-40", name="Sevastopol")))

```

```{r}

ukraine <- read_sf("ukraine.geojson")


dw <- urban_agglomerations


d <- data.frame(colors=c(), shapeISO=c())

for (oblast in oblasts){
  d <- rbind(d, data.frame(colors=c("white"), shapeISO=c(oblast[["shapeISO"]])))
}

d <- rbind(d, data.frame(colors=c("black"), shapeISO=c("UA-65")))
d <- rbind(d, data.frame(colors=c("black"), shapeISO=c("UA-09")))
d <- rbind(d, data.frame(colors=c("black"), shapeISO=c("UA-43")))
d <- rbind(d, data.frame(colors=c("black"), shapeISO=c("UA-40")))

for(siren in all_sirens){
  region <- siren[["region"]]
  
  oblast_iso <- ""
  
  for(oblast in oblasts){
    if(oblast[["name"]] == region){
      oblast_iso <- oblast[["shapeISO"]]
      break
    }
  }
  
  # if(oblast_iso == ""){
  #   print("UNKNOWN LOCATION")
  #   print(region)
  # }
  
  d <- rbind(d, data.frame(colors=c("red"), shapeISO=c(oblast_iso)))
}


ukraine_sirens <- merge(ukraine, d, by="shapeISO")

tm_shape(ukraine_sirens) +
  tm_borders() +
  tm_polygons(col = "colors", palette = "cat") 
  # tm_fill("colors") 
  tm_layout(legend.outside = FALSE) 
  # tm_text("shapeName", size="AREA")+
  # tm_facets(along = "year", free.coords = FALSE)


  # tmap_animation(tm, "tm.gif", loop = TRUE, delay = 80)
  

  # todo animate
```

